<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC '-//ibatis.apache.org//DTD Sql Map 2.0//EN' 'http://ibatis.apache.org/dtd/sql-map-2.dtd'>
<sqlMap namespace="theme">
  <typeAlias alias="themeN" type="theme.thDTO"/>
  <typeAlias alias="theme" type="theme.ThemeDTO"/>
  <typeAlias alias="good" type="theme.GoodDTO" />
  <typeAlias alias="report" type="theme.ReportDTO" />
  <typeAlias alias="comment" type="theme.CommentDTO" />
  <typeAlias alias="memComment" type="theme.MemCommentDTO" />
  
  <resultMap class="themeN" id="tn">
  	<result property="category" column="category"/>
  	<result property="num" column="num"/>
  	<result property="id" column="id"/>
  	<result property="s_name" column="s_name"/>
  	<result property="s_point" column="s_point"/>
  	<result property="e_name" column="e_name"/>
  	<result property="e_point" column="e_point"/>
  	<result property="p1_name" column="p1_name"/>
  	<result property="p1_point" column="p1_point"/>
  	<result property="p2_name" column="p2_name"/>
  	<result property="p2_point" column="p2_point"/>
  	<result property="p3_name" column="p3_name"/>
  	<result property="p3_point" column="p3_point"/>
  	<result property="p4_name" column="p4_name"/>
  	<result property="p4_point" column="p4_point"/>
  	<result property="p5_name" column="p5_name"/>
  	<result property="p5_point" column="p5_point"/>
  	<result property="content" column="content"/>
  	<result property="m_image" column="m_image"/>
  	<result property="s_image" column="s_image"/>
  	<result property="regdate" column="regdate"/>  	
  </resultMap>
  
  <!-- 리절트 맵 정의 -->
  <resultMap class="theme" id="t"  >
    <result property="no" column="no"/>
    <result property="name" column="name"/>
    <result property="subject" column="subject"/>
    <result property="content" column="content"/>
    <result property="file_orgname" column="file_orgname"/>
    <result property="file_savname" column="file_savname"/>
    <result property="readhit" column="readhit"/>
    <result property="good" column="good"/>
    <result property="hate" column="hate"/>
    <result property="regdate" column="regdate"/>
  </resultMap>

  <!--  -->
  <resultMap class="report" id="r">
  	<result property="num" column="num"/>
    <result property="id" column="id"/>
    <result property="subject" column="subject"/>
    <result property="no" column="no"/>
    <result property="content" column="content"/>
    <result property="regdate" column="regdate"/>
    <result property="process" column="process"/>
  </resultMap>
 
  <!--  -->
  <resultMap class="comment" id="c">
    <result property="comment_no" column="commet_no"/>
  	<result property="board_num" column="board_num"/>
    <result property="mem_id" column="mem_id"/>
    <result property="content" column="content"/>
    <result property="reg" column="reg"/>
  </resultMap>
  
  <!--  -->
  <resultMap class="memComment" id="mc">
    <result property="id" column="id"/>
    <result property="nickname" column="nickname"/>
    <result property="content" column="content"/>
    <result property="reg" column="reg"/>
  </resultMap>
  
  <!-- 쿼리문 정의 -->
  <!-- select -->
  <select id="selectAll" resultMap="t" parameterClass="int">
    select * from theme order by no desc
  </select>
  
  <select id="selectOne" resultMap="t" parameterClass="int">
    select * from theme where no =#no#
  </select>
  
  <select id="selectLastNo" resultClass="theme" parameterClass="int">
    select max(no) as no from theme
  </select>
  
  <select id="selectR" resultMap="t" parameterClass="int">
    select * from theme order by readhit desc
  </select>
  
  <select id="selectG" resultMap="t" parameterClass="int">
    select * from theme order by good desc
  </select>
 
  <!-- insert -->
  <insert id="insertTheme" parameterClass="theme">
    insert into theme(no,name,subject,content,regdate)
            values(theme_seq.nextval,#name#,#subject#,#content#,sysdate)
  </insert>
  
  <!-- update -->
  
  <update id="updateFile" parameterClass="theme">
    update theme set file_orgname = #file_orgname#,
                  file_savname = #file_savname# where no = #no#
  </update>
  
  <update id="updateReadHit" parameterClass="int">
    update theme set readhit = readhit + 1 where no = #no# 
  </update>
  
  <!-- delete -->
  
  <delete id="deletetheme" parameterClass="int">
    delete from theme where no=#no#
  </delete>
  
  <!-- 추천,비추천 -->
  <update id="updateGood" parameterClass="int">
   	update theme set good = good +1 where no=#no#
</update>
<update id="downGood" parameterClass="int">
   	update theme set good = good -1 where no=#no#
</update>
   		 
  <select id="selectGood" parameterClass="int" resultClass="int">
    select good from theme where no=#no#
  </select> 
  
  
   		 
  <update id="updateHate" parameterClass="int">
    update theme set hate = hate +1 where no=#no#
  </update>
  
  <update id="downHate" parameterClass="int">
    update theme set hate = hate -1 where no=#no#
  </update>
   		
  <select id="selectHate" parameterClass="int" resultClass="int">
    select hate from theme where no=#no#
  </select>
  	 
  <insert id="insertGood" parameterClass="good">
		
	insert into good (no,
						id,
						gh
                  )
         	 values (  #no#,
         	           #id#,
         	           'good'
                  )
  </insert>
		
  <select id="ctGood" parameterClass="good" resultClass="int">
    select count(1) from good where no=#no# and id=#id# and gh='good'
  </select>
  
  <select id="ctHate" parameterClass="good" resultClass="int">
    select count(1) from good where no=#no# and id=#id# and gh='hate'
  </select>
		
  <insert id="insertHate" parameterClass="good">
		
	insert into good (no,
						id,
						gh
	                 )
	        	 values (  #no#,
	        	           #id#,
	        	           'hate'
	                 )
  </insert>
		
  <delete id="delGood" parameterClass="good">
    delete from good where no=#no# and gh='good'
  </delete> 
  
  <delete id="delHate" parameterClass="good">
    delete from good where no=#no# and gh='hate'
  </delete>
  
  <!-- report -->
  <insert id="insertReport" parameterClass="report">
     insert into report(id,
                        subject,
                        no,
                        content,
                        regdate,
                        num
                        )
                 values(#id#,
                        #subject#,
                        #no#,
                        #content#,
                        sysdate,
                        report_seq.NEXTVAL
                        )
  </insert>	
  
  <!-- report select -->
  
 <select id="selectReport" resultClass="report">
   select * from report order by no desc  
 </select>
 
 <select id="selectView" resultMap="r" parameterClass="int">
   select * from report where num=#num#
 </select>
 
 <update id="proOne" parameterClass="int">
   update report set process= 1 where no=#no#
 </update> 
 
  <update id="proTwo" parameterClass="int">
   update report set process= 2 where num=#num#
 </update>
 
  <update id="proThree" parameterClass="int">
   update report set process= 3 where num=#num#
 </update>
 
  <!-- comment sql -->
  
 <statement id="create" parameterClass="int">
		CREATE TABLE comment_$num$ (
								id varchar2(1000) not null,
								nickname varchar2(4000) not null,
								content varchar2(4000),
								reg date default sysdate
								)
 </statement>
	
	<insert id="insertAllComment" parameterClass="comment">
     insert into comments(
     					comment_no,
                        mem_id,
                        board_num,
                        content,
                        reg
                        )
                 values(
                 		comments_seq.NEXTVAL,
                 		#mem_id#,
                        #board_num#,
                        #content#,
                        #reg#
                        )
  </insert>
  
  <insert id="insertMemComment" parameterClass="java.util.Map">
     insert into comment_$num$(
                        id,
                        nickname,
                        content,
                        reg
                        )
                 values(
                 		#id#,
                        #nickname#,
                        #content#,
                        #reg#
                        )
  </insert>
  
  <select id="memCommentAll" resultMap="mc" parameterClass="int">
    select * from comment_$num$ order by reg asc
  </select>
  
  
</sqlMap>